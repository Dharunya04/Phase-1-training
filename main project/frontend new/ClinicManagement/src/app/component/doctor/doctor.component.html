<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold text-white" href="#">
      Clinic Management - Doctor Dashboard
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarNav" aria-controls="navbarNav"
            aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" 
             [ngClass]="{ active: activeTab === 'availability' }"
             (click)="setActiveTab('availability')">
            Mark Availability
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link"
             [ngClass]="{ active: activeTab === 'appointments' }"
             (click)="setActiveTab('appointments')">
            View Patient Records
          </a>
        </li>

        <li class="nav-item">
  <a class="nav-link" [routerLink]="['/login']">Logout</a>
</li>
      </ul>
    </div>
  </div>
</nav>

<div *ngIf="doctor" class="doctor-info text-center mt-3">
  <h2 class="fw-bold">Welcome Dr. {{ doctor.doctorName }}</h2>
  <p class="text-muted">Specialization: {{ doctor.specialization }}</p>
</div>


<div *ngIf="activeTab === 'availability'" class="mt-3">
  <h3 class="text-dark text-center fw-bold">Manage Availability</h3>

  <div *ngIf="showCalendar" class="calendar-container mt-3">
    <h4 class="month-title text-center text-secondary">
      {{ getMonthName(currentMonth) }} {{ currentYear }}
    </h4>

    <div class="calendar shadow p-3 bg-white rounded">
      <div class="day-header fw-semibold"
           *ngFor="let day of ['Sun','Mon','Tue','Wed','Thu','Fri','Sat']">
        {{ day }}
      </div>
      <div class="calendar-day"
           *ngFor="let day of daysInMonth"
           [ngClass]="{ 'empty-cell': !day, 'available': day && isAvailable(day) }"
           (click)="day && selectDate(day)">
        <span *ngIf="day">{{ day.getDate() }}</span>
        <span *ngIf="day && isAvailable(day)" class="badge bg-success">Available</span>
      </div>
    </div>
  </div>

  <div *ngIf="!showCalendar" class="day-slots mt-3">
    <button class="btn btn-secondary mb-2" (click)="backToCalendar()">Back to Calendar</button>
    <h4 class="text-center fw-semibold">{{ selectedDate }}</h4>

    <div class="slots-grid">
      <div *ngFor="let slot of timeSlots" class="slot-item p-2 border mb-2 rounded shadow-sm"
           [ngClass]="{
             'booked': slot.availability?.isBooked,
             'available': slot.availability && !slot.availability.isBooked,
             'empty': !slot.availability
           }">

        <strong>{{ slot.time }}</strong>
        <div class="text-muted" style="font-size: 12px;">{{ slot.day }}</div>

        <span *ngIf="slot.availability?.isBooked" class="badge bg-danger ms-2">Booked</span>
        <span *ngIf="slot.availability && !slot.availability.isBooked" class="badge bg-success ms-2">Available</span>

        <div *ngIf="slot.availability?.isBooked" class="mt-2">
          <button class="btn btn-sm btn-danger"
                  (click)="deleteSlot(slot.availability!.availabilityId)">
            Delete Booking
          </button>
        </div>

        <div *ngIf="slot.availability && !slot.availability.isBooked" class="mt-2">
          <button class="btn btn-sm btn-warning me-1"
                  (click)="editSlot(slot.availability)">
            Edit
          </button>
          <button class="btn btn-sm btn-danger"
                  (click)="deleteSlot(slot.availability.availabilityId)">
            Delete
          </button>
        </div>

        <button *ngIf="!slot.isPast && slotClicked !== slot.time"
          class="btn btn-sm mt-2"
          [ngClass]="{
            'btn-outline-primary': !slot.availability,
            'btn-success': slot.availability && !slot.availability.isBooked,
            'btn-danger': slot.availability?.isBooked
          }"
          [disabled]="slot.availability?.isBooked"
          (click)="!slot.availability && selectSlot(slot)">
          {{ slot.availability ? (slot.availability.isBooked ? 'Booked' : 'Save Slot') : 'Add Slot' }}
        </button>
        <form *ngIf="!slot.availability && slotClicked === slot.time"
              [formGroup]="availabilityForm"
              (ngSubmit)="onSubmit()"
              class="mt-2">
          <input type="hidden" formControlName="date" />
          <input type="time" formControlName="startTime" readonly />
          <input type="time" formControlName="endTime" readonly />
          <button type="submit" class="btn btn-sm btn-primary mt-1">Save Slot</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div *ngIf="activeTab === 'appointments'" class="container mt-4">
  <h3 class="text-dark fw-bold">My Appointments</h3>
  <div *ngIf="message" class="alert alert-warning">{{ message }}</div>

  <table *ngIf="appointments.length > 0" class="table table-bordered table-striped mt-3 shadow-sm">
    <thead class="table-dark">
      <tr>
        <th>Appointment ID</th>
        <th>Patient Name</th>
        <th>Appointment Date</th>
        <th>Status</th>
        <th>Description</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let appointment of appointments">
        <td>{{ appointment.appointmentId }}</td>
        <td>{{ appointment.patientName }}</td>
        <td>{{ appointment.appointmentDate | date:'short' }}</td>
        <td>
          <span class="badge"
            [ngClass]="{
              'bg-success': appointment.appointmentStatus === 'Scheduled',
              'bg-danger': appointment.appointmentStatus === 'Cancelled'
            }">
            {{ appointment.appointmentStatus }}
          </span>
        </td>
        <td>{{ appointment.reasonForVisit }}</td>
        <td>
          <button class="btn btn-sm btn-success"
                  (click)="markCompleted(appointment.appointmentId)">
            Completed
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<p *ngIf="message" class="text-center mt-2 text-info">{{ message }}</p>
